# ---------- Frontend (React) ----------
    FROM node:18-alpine AS build
    WORKDIR /app
    
    # Accept build-time environment variables
    ARG REACT_APP_CLERK_PUBLISHABLE_KEY
    ARG REACT_APP_API_URL
    ARG REACT_APP_PYTHON_API_URL
    
    # Set environment variables for build
    ENV REACT_APP_CLERK_PUBLISHABLE_KEY=$REACT_APP_CLERK_PUBLISHABLE_KEY
    ENV REACT_APP_API_URL=$REACT_APP_API_URL
    ENV REACT_APP_PYTHON_API_URL=$REACT_APP_PYTHON_API_URL
    
    # Install deps (cached if package*.json unchanged)
    COPY frontend/package*.json ./
    RUN npm ci --omit=dev --no-audit --no-fund --silent
    
    # Copy source and build
    COPY frontend/ ./
    RUN npm run build
    
    # ---------- Runtime ----------
    FROM node:18-alpine
    WORKDIR /app
    
    # Use a tiny static server
    RUN npm i -g serve
    
    # Copy built files only
    COPY --from=build /app/build ./build
    
    EXPOSE 3000
    CMD ["serve", "-s", "build", "-l", "3000"]